# Maintainer: Viacheslav Chimishuk <voice@root.ua>
# Contributors: Nathan Mudie <nathan.mudie@gmail.com>
_pkgname=haproxy
#pkgname=$_pkgname-devel
pkgname=$_pkgname
#_pkgver=1.6
#pkgverdev=dev0
#pkgver=${_pkgver}.${pkgverdev}
pkgver=1.5.9
pkgrel=1
pkgdesc="The Reliable, High Performance TCP/HTTP Load Balancer (development branch)"
arch=('i686' 'x86_64')
url="http://haproxy.1wt.eu"
license=('GPL')
depends=('pcre' 'openssl' 'zlib')
makedepends=('gcc>=4.2.0')
provides=("$_pkgname=$pkgver")
conflicts=("$_pkgname")
backup=('etc/haproxy/haproxy.cfg')
install=$_pkgname.install
#source=("http://haproxy.1wt.eu/download/1.6/src/devel/$_pkgname-$_pkgver-$pkgverdev.tar.gz")
source=("http://www.haproxy.org/download/1.5/src/haproxy-${pkgver}.tar.gz")
sha256sums=('5f51aa8e20a8a3a11be16bd5f5ef382a5e95526803a89182fe1c15a428564722')

build() {
#  cd "$srcdir/$_pkgname-$_pkgver-$pkgverdev"
  cd "$srcdir/$_pkgname-$pkgver"
  make PREFIX=/usr TARGET=linux2628 CPU=native USE_PCRE=1 USE_OPENSSL=1 USE_ZLIB=1
  make -C contrib/systemd PREFIX=/usr
}

package() {
  cd "$srcdir/$_pkgname-$pkgver"

  make PREFIX=/usr DESTDIR="$pkgdir" install

  install -D -m644 examples/haproxy.cfg $pkgdir/etc/haproxy/haproxy.cfg
  install -D -m644 contrib/systemd/haproxy.service $pkgdir/lib/systemd/system/haproxy.service
}
